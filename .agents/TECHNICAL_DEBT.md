# Technical Debt Tracker

**Last Updated:** 2025-12-12

This document tracks known technical debt, incomplete features, and deferred work items.

---

## âœ… Recently Completed (Dec 2025)

### OpenMM Export âœ… COMPLETE

**Status:** Fully implemented and validated

- [x] `AtomicSystem.to_openmm_topology()` - Converts to OpenMM Topology
- [x] `AtomicSystem.to_openmm_system()` - Full force field export:
  - NonbondedForce (charges, LJ with switching function)
  - HarmonicBondForce (bonds with length/k)
  - HarmonicAngleForce (angles with theta/k)
  - PeriodicTorsionForce (proper dihedrals)
  - PeriodicTorsionForce (improper dihedrals)
  - 1-2 exclusions for bonded atoms
  - Proper unit conversions (Ã…â†’nm, kcal/molâ†’kJ/mol)
- [x] Round-trip validation tests (`tests/validation/test_openmm_roundtrip.py`)
- [x] `dihedral_params` and `improper_params` added to AtomicSystem

### Force Field Assets âœ… COMPLETE

- [x] `protein.ff14SB.xml` - Downloaded from openmmforcefields
- [x] `protein.ff19SB.xml` - Already present
- [x] `load_force_field()` function working
- [x] Force field tests updated (`tests/assets/test_forcefields.py`)

### Code Cleanup & Protein API Simplification âœ… COMPLETE

- [x] Remove extra dataclasses from `containers.py`
- [x] Simplify `Protein` API
- [x] Move IO-specific types to `priox.io`
- [x] ProteinTuple deprecation and removal
- [x] AtomicSystem architecture implementation

---

## ðŸ”´ High Priority (Blocking Validation)

### Hydrogen Addition Geometry Issues

**Status:** Partial - Hydrogen placement works but geometry has issues

**Current state:**

- âœ… Hydrogen templates for amino acids
- âœ… `add_hydrogens()` function works
- âœ… Energy relaxation implemented
- âš ï¸ Bond length geometry issues (N-H distances sometimes too short)
- âš ï¸ `test_bond_lengths_geometry` failing

**Required for:** Full parity with hydride library

### Trajectory Format Integration Tests

**Status:** Implemented but require `trajectories` feature

**Files:**

- `formats/dcd.rs` - implemented
- `formats/trr.rs` - implemented
- `formats/xtc.rs` - implemented

**Current Issue:** Tests require compiling with `trajectories` feature (chemfiles)

**Tasks:**

- [ ] Enable `trajectories` feature in Rust build
- [ ] Add test trajectory files to `tests/data/trajectories/`
- [ ] Run parity tests vs MDTraj

---

## ðŸŸ¡ Medium Priority (Not Blocking)

### GAFF Atom Typing (In Progress - Separate Agent)

**Status:** Being worked on by another agent

**Current State:**

- âŒ GAFF XML files are dynamically generated by openmmforcefields
- âŒ Automatic atom type assignment from connectivity

**Approach Options:**

1. Integrate with `openmmforcefields.generators.GAFFTemplateGenerator`
2. Use AmberTools directly (antechamber, parmchk2)
3. Port GAFF typing rules to Rust

### Documentation Refresh

**Status:** Pending

**Tasks:**

- [ ] Update `docs/` folder with current API
- [ ] Add usage examples for OpenMM export
- [ ] Review/update docstring citations
- [ ] Add examples for `add_hydrogens`, `relax_hydrogens`, and MD parameterization

### Test Suite Cleanup

**Status:** Some outdated tests found

**Issues Found:**

- `tests/io/parsing/test_dispatch.py` - Tests for `estat_backbone_mask` attribute (not on Protein)
- `tests/io/parsing/test_foldcomp_extended.py` - Tests for `source` attribute (not on Protein)

**Tasks:**

- [ ] Review and update/remove outdated tests
- [ ] Ensure all tests pass or are properly skipped

---

## â¬œ Deferred (Future Work)

### Performance Benchmarking

**Status:** Not started

**Tasks:**

- [ ] Create `benchmarks/rust_vs_python.py`
- [ ] Measure parsing speed (PDB/mmCIF) vs Biotite
- [ ] Measure formatting speed (Atom37) vs original priox
- [ ] Measure hydrogen addition time vs hydride

### 1-3 and 1-4 Exclusions in OpenMM

**Status:** Only 1-2 exclusions implemented

**Tasks:**

- [ ] Compute 1-3 exclusions from angles
- [ ] Compute 1-4 pairs from dihedrals
- [ ] Apply 1-4 scaling factors (coulomb14scale, lj14scale)

### CMAPForce Support

**Status:** Not implemented

**Note:** CMAP is important for accurate backbone sampling in protein force fields (ff14SB, ff19SB)

---

## Code Health Notes

### Lint Warnings (Acceptable)

The `to_openmm_system()` method has complexity warnings (22 > 10, 21 branches, 83 statements). These are acceptable for a comprehensive export method - splitting would reduce readability.

### Test Coverage

Current test status:

- Core tests: ~140 passing
- Validation tests: Some require OpenMM or trajectory features
- Skip patterns working correctly for optional dependencies
