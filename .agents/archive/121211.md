# Master Task List (2025-12-11)

Comprehensive backlog of remaining work for the priox Rust migration.

## ðŸ”´ Priority 1: Validation & Parity (Immediate)

### P1.1 Hydrogen Addition Parity âœ…

**Objective:** Match `hydride` behavior exactly.
**Status:** Complete (3 tests passing, 1 warning about N-terminal H count diff)

- [x] **Validation Script:** `tests/validation/test_hydrogen_parity.py`
  - [x] `test_hydrogen_counts` - Compare H counts per residue vs `hydride`
  - [x] `test_bond_lengths_geometry` - Check N-H/C-H bond lengths
  - [x] `test_relaxation_consistency` - Validate relaxation only moves H atoms
- [x] **Terminal Capping:** `tests/validation/test_terminals.py`
  - [x] `test_terminal_hydrogens_counts` - Verify N/C-terminal H counts

> **Note:** Res 1 H count mismatch warning expected - N-terminal charging differs slightly (Rust=6, Ref=5 hydrogens).

### P1.2 Structure Parsing Parity âœ…

**Objective:** Ensure Rust parser produces identical results to Python/Biotite parsers.
**Status:** Complete (2 tests passing)

- [x] **Coordinate Parity:** `test_coordinate_parity_1crn` - PDB coordinates match to 1e-3 Ã…
- [x] **Residue Grouping:** `test_residue_identity_parity` - Residue IDs match

### P1.3 Physics Features Parity âœ…

**Status:** Complete (5 tests passing, 1 skipped for electrostatics w/o charges)

- [x] **RBF:** `test_rbf_output_shape`, `test_rbf_values_reasonable`
- [x] **Electrostatics:** `test_electrostatics_output_shape` (skipped w/o charges), `test_coulomb_physics_sanity`
- [x] **Dihedrals:** `test_dihedral_parity_vs_mdtraj` - Match MDTraj phi/psi/omega

---

## ðŸŸ¡ Priority 2: Missing Core Functionality

### P2.1 OpenMM Export âœ…

**Objective:** Enable simulation directly from parsed AtomicSystem.
**Status:** Complete (Dec 2025)

- [x] Implement `AtomicSystem.to_openmm_topology()`
- [x] Implement `AtomicSystem.to_openmm_system()` with:
  - NonbondedForce (charges, LJ with switching function)
  - HarmonicBondForce (bonds with length/k)
  - HarmonicAngleForce (angles with theta/k)  
  - PeriodicTorsionForce (proper dihedrals)
  - PeriodicTorsionForce (improper dihedrals)
  - 1-2 exclusions for bonded atoms
  - 1-3 exclusions for angle atoms
  - 1-4 exclusions/scaling for dihedral atoms (with custom scaling factors)
  - Proper unit conversions (Ã…â†’nm, kcal/molâ†’kJ/mol)
- [x] Round-trip validation test: `tests/validation/test_openmm_roundtrip.py`
  - Energy minimization test
  - Torsion parameter verification
  - Topology/bond tests
- [x] Added `dihedral_params` and `improper_params` arrays to AtomicSystem

> **Note:** OpenMM is an optional dependency (install via conda). Tests skip gracefully if not available.

### P2.2 GAFF Support

**Objective:** Parameterize non-standard residues/ligands.
**Status:** Blocked - GAFF XML files are dynamically generated by openmmforcefields

- [ ] Rust: Parse GAFF XML force field files
- [ ] Rust: Connectivity-based atom matcher for GAFF types
- [ ] Python: Wrapper to call antechamber/openbabel if needed for charges

> **Note:** `openmmforcefields` no longer ships static GAFF XML files. Consider integrating with their `GAFFTemplateGenerator` or using AmberTools directly.

### P2.4 Force Field Assets âœ…

**Objective:** Populate `src/priox/assets/` with standard force field XMLs.
**Status:** Complete (Dec 2025)

- [x] `protein.ff14SB.xml` - Downloaded from openmmforcefields
- [x] `protein.ff19SB.xml` - Already present
- [x] `load_force_field()` function verified working
- [x] `list_available_force_fields()` returns available assets

### P2.3 Topology Attribute âœ…

**Objective:** Add basic connectivity matrix to AtomicSystem.
**Status:** Complete (implemented in `src/priox/core/atomic_system.py`)

- [x] `topology` property - Returns sparse (N_atoms, N_atoms) adjacency matrix from bonds
- [x] `num_bonds` property - Returns count of bonds in the system
- [x] Consistent indexing with `coordinates` via `atom_mask`

---

## âšª Priority 3: Polish & Documentation

### P3.1 Trajectory Support Validation ðŸ”„

**Status:** In Progress - Tests created, awaiting test data

- [x] Create `tests/validation/test_trajectory_parity.py` with 12 tests
- [x] Add `parse_dcd` and `parse_trr` PyO3 bindings to `lib.rs`
- [ ] Add test trajectory files (DCD/TRR/XTC) to `tests/data/trajectories/`
- [ ] Run parity tests against MDTraj

### P3.2 Documentation

- [ ] Update `docs/` with new `OutputSpec` API
- [ ] Add explicit examples for `add_hydrogens`, `relax_hydrogens`, and `MD` parameterization

---

## ðŸ”µ Priority 4: Performance Benchmarking (Last Stage)

### P4.1 Benchmarking Suite

- [ ] Create `benchmarks/rust_vs_python.py`
- [ ] Measure parsing speed (PDB/mmCIF) vs Biotite
- [ ] Measure formatting speed (Atom37) vs original priox
- [ ] Measure hydrogen addition time vs hydride
